# This is a basic workflow that is manually triggered

on:
  push:
    # Sequence of patterns matched against refs/tags
    tags:
      - 'v*' # Push events to matching v*, i.e. v1.0, v20.15.10

name: update debian changelog

jobs:
  build:
    name: update changelog
    runs-on: ubuntu-latest
    steps:
    - name: Checkout master      
      uses: actions/checkout@master
      with:
          ref: master
          fetch-depth: 0
    - name: Run info        
      run: |
            CURR_DIR=$(pwd)
            gitTagList=$(git -C $CURR_DIR tag --sort=-version:refname)
            gitTagListCount=$(echo -n "$gitTagList" | grep -c '^')
            if [[ 1 -ge "$gitTagListCount" ]]; then
                echo "Use all entries for a release note:"
                releaseNote=$(git -C $CURR_DIR log --date=short --pretty=format:"  * %s [%aN] %ad")
            else
                tmpval=$(echo "${gitTagList}" | awk 'NR==2{print}')
                gitTagRange="${tmpval}..${revision}"
                echo "Release note range [$gitTagRange]"
                releaseNote=$(git -C $CURR_DIR log "$gitTagRange" --date=short --pretty=format:"  * %s [%aN] %ad")
            fi
            echo ""
            echo "***** Prepare distr changelog";
            echo ""
            echo "logview (${Major}.${Minor}.${buildnum}) unstable; urgency=medium"         > "${CURR_DIR}/debian/changelog"
            echo ""                                                                        >> "${CURR_DIR}/debian/changelog"
            echo "$releaseNote"                                                            >> "${CURR_DIR}/debian/changelog"
            echo ""                                                                        >> "${CURR_DIR}/debian/changelog"
            echo " -- chipmunk.sm <dannico@linuxmail.org>  $(LANG=C date -R)"              >> "${CURR_DIR}/debian/changelog"
            cat "${CURR_DIR}/debian/changelog"
      

